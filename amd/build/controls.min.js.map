{"version":3,"file":"controls.min.js","sources":["../src/controls.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module controls\n *\n * @module     theme_bambuco/controls\n * @copyright  2025 David Herney @ BambuCo\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Modal from 'core/modal';\nimport ModalEvents from 'core/modal_events';\nimport Log from 'core/log';\n\n/**\n * Initialize the component.\n *\n */\nexport const init = async() => {\n\n    // Open resources into modal.\n    $('.bbco-openinmodal').each(function() {\n        var $this = $(this);\n\n        if ($this.parents('[data-fieldtype=\"editor\"]') && $this.parents('[data-fieldtype=\"editor\"]').length > 0) {\n            return;\n        }\n\n        $this.find('a').each(function() {\n            this.removeAttribute('onclick');\n        });\n\n        $this.find('a').on('click', function(event) {\n            event.preventDefault();\n\n            var $link = $(this);\n\n            var dialogue = $link.data('dialogue');\n\n            if (!dialogue) {\n\n                var w = $this.attr('data-property-width');\n                var h = $this.attr('data-property-height');\n\n                var url = $link.attr('href') + '&inpopup=true';\n                var $iframe = $('<iframe class=\"bbco-openinmodal-container\"></iframe>');\n                $iframe.attr('src', url);\n                $iframe.on('load', function() {\n                    $iframe.contents().find('a:not([target])').attr('target', '_top');\n                });\n\n                var el = $.fn.hide;\n                $.fn.hide = function() {\n                    this.trigger('hide');\n                    return el.apply(this, arguments);\n                };\n\n                var $floatwindow = $('<div></div>');\n\n                $floatwindow.append($iframe);\n\n                var properties = {\n                    width: '95vw',\n                    height: '95vh',\n                };\n\n                if (w) {\n                    if (w.indexOf('%') >= 0) {\n                        var windowW = $(window).width();\n                        var tmpW = Number(w.replace('%', ''));\n                        if (!isNaN(tmpW) && tmpW > 0) {\n                            w = tmpW * windowW / 100;\n                        }\n                    }\n\n                    if (!isNaN(w)) {\n                        w += 'px';\n                    }\n\n                    properties.width = w;\n                }\n\n                if (h) {\n                    if (h.indexOf('%') >= 0) {\n                        var windowH = $(window).height();\n                        var tmpH = Number(h.replace('%', ''));\n                        if (!isNaN(tmpH) && tmpH > 0) {\n                            h = tmpH * windowH / 100;\n                        }\n                    }\n\n                    if (!isNaN(h)) {\n                        h += 'px';\n                    }\n\n                    properties.height = h;\n                }\n\n                Modal.create({\n                    body: $iframe,\n                    title: $link.attr('title') || $link.text(),\n                })\n                .then(function(modal) {\n\n                    // When the dialog is closed, pause video and audio.\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        $iframe.contents().find('video, audio').each(function() {\n                            this.pause();\n                        });\n                    });\n\n                    modal.getRoot().find('> .modal-dialog').attr('style', 'width: ' + properties.width +\n                                                                    '; height: ' + properties.height + ';')\n                                                                    .addClass('bbco-modal-dialog');\n                    modal.show();\n                    $link.data('dialogue', modal);\n\n                    return modal;\n                })\n                .catch(function(e) {\n                    Log.debug('Error creating modal');\n                    Log.debug(e);\n                });\n\n            } else {\n                dialogue.show();\n            }\n\n        });\n\n    });\n};\n"],"names":["async","each","$this","this","parents","length","find","removeAttribute","on","event","preventDefault","$link","dialogue","data","show","w","attr","h","url","$iframe","contents","el","$","fn","hide","trigger","apply","arguments","append","properties","width","height","indexOf","windowW","window","tmpW","Number","replace","isNaN","windowH","tmpH","create","body","title","text","then","modal","getRoot","ModalEvents","hidden","pause","addClass","catch","e","debug"],"mappings":";;;;;;;oQAgCoBA,8BAGd,qBAAqBC,MAAK,eACpBC,OAAQ,mBAAEC,MAEVD,MAAME,QAAQ,8BAAgCF,MAAME,QAAQ,6BAA6BC,OAAS,IAItGH,MAAMI,KAAK,KAAKL,MAAK,gBACZM,gBAAgB,cAGzBL,MAAMI,KAAK,KAAKE,GAAG,SAAS,SAASC,OACjCA,MAAMC,qBAEFC,OAAQ,mBAAER,MAEVS,SAAWD,MAAME,KAAK,eAErBD,SAsFDA,SAASE,WAtFE,KAEPC,EAAIb,MAAMc,KAAK,uBACfC,EAAIf,MAAMc,KAAK,wBAEfE,IAAMP,MAAMK,KAAK,QAAU,gBAC3BG,SAAU,mBAAE,wDAChBA,QAAQH,KAAK,MAAOE,KACpBC,QAAQX,GAAG,QAAQ,WACfW,QAAQC,WAAWd,KAAK,mBAAmBU,KAAK,SAAU,eAG1DK,GAAKC,gBAAEC,GAAGC,qBACZD,GAAGC,KAAO,uBACHC,QAAQ,QACNJ,GAAGK,MAAMvB,KAAMwB,aAGP,mBAAE,eAERC,OAAOT,aAEhBU,WAAa,CACbC,MAAO,OACPC,OAAQ,WAGRhB,EAAG,IACCA,EAAEiB,QAAQ,MAAQ,EAAG,KACjBC,SAAU,mBAAEC,QAAQJ,QACpBK,KAAOC,OAAOrB,EAAEsB,QAAQ,IAAK,MAC5BC,MAAMH,OAASA,KAAO,IACvBpB,EAAIoB,KAAOF,QAAU,KAIxBK,MAAMvB,KACPA,GAAK,MAGTc,WAAWC,MAAQf,KAGnBE,EAAG,IACCA,EAAEe,QAAQ,MAAQ,EAAG,KACjBO,SAAU,mBAAEL,QAAQH,SACpBS,KAAOJ,OAAOnB,EAAEoB,QAAQ,IAAK,MAC5BC,MAAME,OAASA,KAAO,IACvBvB,EAAIuB,KAAOD,QAAU,KAIxBD,MAAMrB,KACPA,GAAK,MAGTY,WAAWE,OAASd,iBAGlBwB,OAAO,CACTC,KAAMvB,QACNwB,MAAOhC,MAAMK,KAAK,UAAYL,MAAMiC,SAEvCC,MAAK,SAASC,cAGXA,MAAMC,UAAUvC,GAAGwC,sBAAYC,QAAQ,WACnC9B,QAAQC,WAAWd,KAAK,gBAAgBL,MAAK,gBACpCiD,cAIbJ,MAAMC,UAAUzC,KAAK,mBAAmBU,KAAK,QAAS,UAAYa,WAAWC,MAC7B,aAAeD,WAAWE,OAAS,KAClCoB,SAAS,qBAC1DL,MAAMhC,OACNH,MAAME,KAAK,WAAYiC,OAEhBA,SAEVM,OAAM,SAASC,gBACRC,MAAM,qCACNA,MAAMD"}